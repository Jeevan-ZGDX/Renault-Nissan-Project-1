<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Admin dashboard for managing menu items and categories. Add, edit, and delete menu items with category assignments."/>
  <title>Admin Menu Management - Daily Menu</title>
  <link rel="icon" href="/favicon.jpg" type="image/jpeg"/>
  <link rel="manifest" href="/manifest.json"/>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&amp;family=Poppins:wght@400;500;600;700&amp;family=Roboto:wght@500;700&amp;display=swap" rel="stylesheet"/>

  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Quill.js CSS -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet"/>

  <!-- jQuery CDN -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <!-- Quill.js CDN -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

  <!-- Moment.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

  <!-- Auth Helper -->
  <script src="/auth-helper.js"></script>

  <!-- Auth Check -->
  <script src="/auth-check.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      color: #2C3E50;
      background-color: #FFFFFF;
    }
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Poppins', sans-serif;
      color: #2C3E50;
    }
    .ql-toolbar.ql-snow {
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      border-color: #ECF0F1;
      background-color: #F8F8F8;
    }
    .ql-container.ql-snow {
      border-bottom-left-radius: 8px;
      border-bottom-right-radius: 8px;
      border-color: #ECF0F1;
      min-height: 200px;
    }
    .ql-editor {
      min-height: 200px;
      font-family: 'Inter', sans-serif;
      color: #2C3E50;
    }
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #ECF0F1;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb {
      background: #7F8C8D;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #2C3E50;
    }
    .fade-in {
      animation: fadeIn 300ms ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .scale-hover:hover {
      transform: scale(1.02);
      transition: transform 200ms ease-in-out;
    }
    /* Prevent scrolling */
    html, body {
      height: 100%;
      overflow: hidden;
    }
    .content-wrapper {
      height: calc(100vh - 72px);
      overflow-y: auto;
      padding-top: 72px;
    }
    .menu-items-container {
      max-height: calc(100vh - 500px);
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <header class="bg-[#2C3E50] text-white fixed top-0 left-0 right-0 z-50 shadow-md" data-storm-selectable="true" data-storm-selectable-label="Header Navigation" data-storm-selectable-category="header">
    <nav class="container mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <!-- Brand/Logo -->
        <div class="flex items-center">
          <a href="/index.html" class="text-2xl font-semibold font-[&#39;Poppins&#39;] tracking-wide hover:text-[#E67E22] transition-colors duration-200">
            Daily Menu
          </a>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center space-x-6">
          <!-- Authenticated User Navigation -->
          <div id="authNav" class="hidden items-center space-x-6">
            <a href="/index.html" class="font-[&#39;Poppins&#39;] font-medium text-base hover:text-[#E67E22] transition-colors duration-200 py-2 px-3 rounded">
              Menu Selection
            </a>
            <a href="/admin_dashboard.html" id="adminLink" class="hidden font-[&#39;Poppins&#39;] font-medium text-base hover:text-[#E67E22] transition-colors duration-200 py-2 px-3 rounded">
              Admin Dashboard
            </a>
            <a href="/tv_display.html" class="font-[&#39;Poppins&#39;] font-medium text-base hover:text-[#E67E22] transition-colors duration-200 py-2 px-3 rounded">
              TV Display
            </a>
            <div class="flex items-center space-x-3 ml-4 pl-4 border-l border-white border-opacity-30">
              <span id="userRole" class="bg-[#27AE60] text-white text-sm font-[&#39;Poppins&#39;] font-medium px-3 py-1 rounded-full">User</span>
              <button id="logoutBtn" class="bg-[#E67E22] hover:bg-[#D35400] text-white font-[&#39;Poppins&#39;] font-medium text-base px-4 py-2 rounded transition-all duration-200 hover:scale-105">
                Logout
              </button>
            </div>
          </div>

          <!-- Unauthenticated Navigation -->
          <div id="guestNav" class="flex items-center space-x-4">
            <a href="/login.html" class="font-[&#39;Poppins&#39;] font-medium text-base hover:text-[#E67E22] transition-colors duration-200 py-2 px-3 rounded">
              Login
            </a>
            <a href="/signup.html" class="bg-[#E67E22] hover:bg-[#D35400] text-white font-[&#39;Poppins&#39;] font-medium text-base px-4 py-2 rounded transition-all duration-200 hover:scale-105">
              Sign Up
            </a>
          </div>
        </div>

        <!-- Mobile Menu Toggle -->
        <button id="mobileMenuBtn" class="md:hidden text-white hover:text-[#E67E22] transition-colors duration-200 p-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>

      <!-- Mobile Navigation Menu -->
      <div id="mobileMenu" class="hidden md:hidden mt-4 pb-4 border-t border-white border-opacity-20 pt-4">
        <!-- Authenticated Mobile Navigation -->
        <div id="authNavMobile" class="hidden flex-col space-y-3">
          <a href="/index.html" class="font-[&#39;Poppins&#39;] font-medium text-base hover:text-[#E67E22] transition-colors duration-200 py-2 px-3 rounded block">
            Menu Selection
          </a>
          <a href="/admin_dashboard.html" id="adminLinkMobile" class="hidden font-[&#39;Poppins&#39;] font-medium text-base hover:text-[#E67E22] transition-colors duration-200 py-2 px-3 rounded block">
            Admin Dashboard
          </a>
          <a href="/tv_display.html" class="font-[&#39;Poppins&#39;] font-medium text-base hover:text-[#E67E22] transition-colors duration-200 py-2 px-3 rounded block">
            TV Display
          </a>
          <div class="flex flex-col space-y-3 pt-3 border-t border-white border-opacity-20">
            <span id="userRoleMobile" class="bg-[#27AE60] text-white text-sm font-[&#39;Poppins&#39;] font-medium px-3 py-1 rounded-full self-start">User</span>
            <button id="logoutBtnMobile" class="bg-[#E67E22] hover:bg-[#D35400] text-white font-[&#39;Poppins&#39;] font-medium text-base px-4 py-2 rounded transition-all duration-200 w-full">
              Logout
            </button>
          </div>
        </div>

        <!-- Unauthenticated Mobile Navigation -->
        <div id="guestNavMobile" class="flex flex-col space-y-3">
          <a href="/login.html" class="font-[&#39;Poppins&#39;] font-medium text-base hover:text-[#E67E22] transition-colors duration-200 py-2 px-3 rounded block">
            Login
          </a>
          <a href="/signup.html" class="bg-[#E67E22] hover:bg-[#D35400] text-white font-[&#39;Poppins&#39;] font-medium text-base px-4 py-2 rounded transition-all duration-200 text-center">
            Sign Up
          </a>
        </div>
      </div>
    </nav>
  </header>

  <div class="content-wrapper">
    <main class="container mx-auto px-4 py-8">
      <!-- Page Title -->
      <div class="mb-8" data-storm-selectable="true" data-storm-selectable-label="Page Title" data-storm-selectable-category="text">
        <h1 class="text-4xl font-bold font-[&#39;Poppins&#39;] text-[#2C3E50] mb-2">Admin Menu Management</h1>
        <p class="text-[#7F8C8D] font-[&#39;Inter&#39;]">Add, edit, and manage menu items and their categories</p>
      </div>

      <!-- Two Column Layout -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Left Column: Add Menu Item Form -->
        <div class="bg-white rounded-lg shadow-md p-6" data-storm-selectable="true" data-storm-selectable-label="Add Menu Item Form" data-storm-selectable-category="form">
          <h2 class="text-2xl font-semibold font-[&#39;Poppins&#39;] text-[#2C3E50] mb-6">Add New Menu Item</h2>
          
          <form id="addMenuItemForm">
            <!-- Name Field -->
            <div class="mb-4">
              <label for="itemName" class="block text-sm font-medium font-[&#39;Poppins&#39;] text-[#2C3E50] mb-2">Item Name</label>
              <input type="text" id="itemName" name="itemName" required="" class="w-full px-4 py-2 border border-[#ECF0F1] rounded-lg focus:outline-none focus:border-[#E67E22] transition-colors duration-200 font-[&#39;Inter&#39;]" placeholder="Enter menu item name"/>
            </div>

            <!-- Description Field with Quill Editor -->
            <div class="mb-4">
              <label for="itemDescription" class="block text-sm font-medium font-[&#39;Poppins&#39;] text-[#2C3E50] mb-2">Description</label>
              <div id="quillEditor"></div>
            </div>

            <!-- Category Assignment -->
            <div class="mb-6">
              <label class="block text-sm font-medium font-[&#39;Poppins&#39;] text-[#2C3E50] mb-3">Assign to Meal Courses</label>
              <div class="grid grid-cols-2 gap-3">
                <label class="flex items-center space-x-2 cursor-pointer">
                  <input type="checkbox" name="category" value="Breakfast" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
                  <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Breakfast</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer">
                  <input type="checkbox" name="category" value="Regular Lunch" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
                  <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Regular Lunch</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer">
                  <input type="checkbox" name="category" value="Diet Lunch" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
                  <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Diet Lunch</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer">
                  <input type="checkbox" name="category" value="Mini Meals" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
                  <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Mini Meals</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer">
                  <input type="checkbox" name="category" value="Regular Dinner" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
                  <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Regular Dinner</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer">
                  <input type="checkbox" name="category" value="Diet Dinner" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
                  <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Diet Dinner</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer">
                  <input type="checkbox" name="category" value="Supper" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
                  <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Supper</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer">
                  <input type="checkbox" name="category" value="Special Item" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
                  <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Special Item</span>
                </label>
              </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="w-full bg-[#E67E22] hover:bg-[#D35400] text-white font-[&#39;Poppins&#39;] font-medium py-3 px-6 rounded-lg transition-all duration-200 hover:scale-105">
              Add Menu Item
            </button>
          </form>

          <!-- Success/Error Messages -->
          <div id="formMessage" class="mt-4 hidden"></div>
        </div>

        <!-- Right Column: Menu Items List -->
        <div class="bg-white rounded-lg shadow-md p-6" data-storm-selectable="true" data-storm-selectable-label="Menu Items List" data-storm-selectable-category="section">
          <h2 class="text-2xl font-semibold font-[&#39;Poppins&#39;] text-[#2C3E50] mb-6">Current Menu Items</h2>
          
          <!-- Loading State -->
          <div id="loadingState" class="text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-[#E67E22]"></div>
            <p class="mt-2 text-[#7F8C8D] font-[&#39;Inter&#39;]">Loading menu items...</p>
          </div>

          <!-- Empty State -->
          <div id="emptyState" class="hidden text-center py-8">
            <svg class="mx-auto h-16 w-16 text-[#ECF0F1] mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <p class="text-[#7F8C8D] font-[&#39;Inter&#39;]">No menu items yet. Add your first item to get started!</p>
          </div>

          <!-- Error State -->
          <div id="errorState" class="hidden text-center py-8">
            <svg class="mx-auto h-16 w-16 text-[#E74C3C] mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <p class="text-[#E74C3C] font-[&#39;Inter&#39;] mb-2">Couldn&#39;t load menu items.</p>
            <button id="retryLoadBtn" class="text-[#E67E22] hover:text-[#D35400] font-[&#39;Poppins&#39;] font-medium">Try again</button>
          </div>

          <!-- Menu Items Container -->
          <div id="menuItemsContainer" class="menu-items-container space-y-4 hidden"></div>
        </div>
      </div>
    </main>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden" data-storm-selectable="true" data-storm-selectable-label="Delete Confirmation Modal" data-storm-selectable-category="modal">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4 relative">
      <h3 class="text-xl font-[&#39;Poppins&#39;] font-semibold text-[#2C3E50] mb-4">Confirm Deletion</h3>
      <p class="text-[#7F8C8D] mb-6 font-[&#39;Inter&#39;]">Are you sure you want to delete this menu item? This action cannot be undone.</p>
      <div class="flex justify-end space-x-3">
        <button id="cancelDeleteBtn" class="bg-gray-300 hover:bg-gray-400 text-[#2C3E50] font-[&#39;Poppins&#39;] font-medium py-2 px-4 rounded transition-colors duration-200">Cancel</button>
        <button id="confirmDeleteBtn" class="bg-[#E74C3C] hover:bg-[#C0392B] text-white font-[&#39;Poppins&#39;] font-medium py-2 px-4 rounded transition-colors duration-200">Delete</button>
      </div>
      <button id="closeDeleteModalBtn" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Edit Menu Item Modal -->
  <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden" data-storm-selectable="true" data-storm-selectable-label="Edit Menu Item Modal" data-storm-selectable-category="modal">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full mx-4 relative" style="max-height: 90vh; overflow-y: auto;">
      <h3 class="text-xl font-[&#39;Poppins&#39;] font-semibold text-[#2C3E50] mb-4">Edit Menu Item</h3>
      
      <form id="editMenuItemForm">
        <input type="hidden" id="editItemId"/>
        
        <!-- Name Field -->
        <div class="mb-4">
          <label for="editItemName" class="block text-sm font-medium font-[&#39;Poppins&#39;] text-[#2C3E50] mb-2">Item Name</label>
          <input type="text" id="editItemName" name="editItemName" required="" class="w-full px-4 py-2 border border-[#ECF0F1] rounded-lg focus:outline-none focus:border-[#E67E22] transition-colors duration-200 font-[&#39;Inter&#39;]"/>
        </div>

        <!-- Description Field with Quill Editor -->
        <div class="mb-4">
          <label for="editItemDescription" class="block text-sm font-medium font-[&#39;Poppins&#39;] text-[#2C3E50] mb-2">Description</label>
          <div id="editQuillEditor"></div>
        </div>

        <!-- Category Assignment -->
        <div class="mb-6">
          <label class="block text-sm font-medium font-[&#39;Poppins&#39;] text-[#2C3E50] mb-3">Assign to Meal Courses</label>
          <div class="grid grid-cols-2 gap-3">
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" name="editCategory" value="Breakfast" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
              <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Breakfast</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" name="editCategory" value="Regular Lunch" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
              <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Regular Lunch</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" name="editCategory" value="Diet Lunch" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
              <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Diet Lunch</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" name="editCategory" value="Mini Meals" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
              <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Mini Meals</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" name="editCategory" value="Regular Dinner" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
              <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Regular Dinner</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" name="editCategory" value="Diet Dinner" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
              <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Diet Dinner</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" name="editCategory" value="Supper" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
              <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Supper</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" name="editCategory" value="Special Item" class="w-4 h-4 text-[#27AE60] border-gray-300 rounded focus:ring-[#27AE60]"/>
              <span class="text-sm font-[&#39;Inter&#39;] text-[#2C3E50]">Special Item</span>
            </label>
          </div>
        </div>

        <div class="flex justify-end space-x-3">
          <button type="button" id="cancelEditBtn" class="bg-gray-300 hover:bg-gray-400 text-[#2C3E50] font-[&#39;Poppins&#39;] font-medium py-2 px-4 rounded transition-colors duration-200">Cancel</button>
          <button type="submit" class="bg-[#E67E22] hover:bg-[#D35400] text-white font-[&#39;Poppins&#39;] font-medium py-2 px-4 rounded transition-colors duration-200">Save Changes</button>
        </div>
      </form>

      <button id="closeEditModalBtn" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>

  <script type="module">
    import ClientAPI from '/client.js';

    let quill;
    let editQuill;
    let menuItemToDelete = null;
    const api = new ClientAPI();

    // Initialize Quill editors
    function initializeQuillEditors() {
      quill = new Quill('#quillEditor', {
        theme: 'snow',
        placeholder: 'Enter menu item description...',
        modules: {
          toolbar: [
            ['bold', 'italic', 'underline'],
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            ['clean']
          ]
        }
      });

      editQuill = new Quill('#editQuillEditor', {
        theme: 'snow',
        placeholder: 'Enter menu item description...',
        modules: {
          toolbar: [
            ['bold', 'italic', 'underline'],
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            ['clean']
          ]
        }
      });
    }

    // Show message
    function showMessage(message, isError = false) {
      const messageDiv = $('#formMessage');
      messageDiv.removeClass('hidden');
      messageDiv.html(`
        <div class="p-4 rounded-lg ${isError ? 'bg-red-100 text-[#E74C3C]' : 'bg-green-100 text-[#27AE60]'} font-['Inter'] fade-in">
          ${message}
        </div>
      `);
      
      setTimeout(() => {
        messageDiv.addClass('hidden');
      }, 5000);
    }

    // Load menu items
    async function loadMenuItems() {
      $('#loadingState').removeClass('hidden');
      $('#emptyState').addClass('hidden');
      $('#errorState').addClass('hidden');
      $('#menuItemsContainer').addClass('hidden');

      try {
        const response = await api.getMenuItems();
        const menuItems = response.menu_items || [];

        $('#loadingState').addClass('hidden');

        if (menuItems.length === 0) {
          $('#emptyState').removeClass('hidden');
        } else {
          $('#menuItemsContainer').removeClass('hidden');
          renderMenuItems(menuItems);
        }
      } catch (error) {
        console.error('Error loading menu items:', error);
        $('#loadingState').addClass('hidden');
        $('#errorState').removeClass('hidden');
      }
    }

    // Render menu items
    function renderMenuItems(menuItems) {
      const container = $('#menuItemsContainer');
      container.empty();

      menuItems.forEach(item => {
        const categories = item.categories && item.categories.length > 0 
          ? item.categories.map(cat => `<span class="inline-block bg-[#27AE60] text-white text-xs px-2 py-1 rounded-full mr-1 mb-1">${cat}</span>`).join('')
          : '<span class="text-[#7F8C8D] text-sm italic">No categories assigned</span>';

        const itemCard = $(`
          <div class="bg-[#ECF0F1] rounded-lg p-4 scale-hover fade-in" data-item-id="${item.menu_item_id}">
            <div class="flex justify-between items-start mb-2">
              <h3 class="text-lg font-semibold font-['Poppins'] text-[#2C3E50]">${item.name || 'Untitled Item'}</h3>
              <div class="flex space-x-2">
                <button class="edit-item-btn text-[#E67E22] hover:text-[#D35400] transition-colors duration-200" data-item-id="${item.menu_item_id}">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                  </svg>
                </button>
                <button class="delete-item-btn text-[#E74C3C] hover:text-[#C0392B] transition-colors duration-200" data-item-id="${item.menu_item_id}">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                </button>
              </div>
            </div>
            <div class="text-sm text-[#7F8C8D] font-['Inter'] mb-3 ql-editor-content">${item.description || 'No description'}</div>
            <div class="flex flex-wrap">${categories}</div>
          </div>
        `);

        container.append(itemCard);
      });

      // Attach event listeners
      $('.delete-item-btn').on('click', function() {
        const itemId = $(this).data('item-id');
        openDeleteModal(itemId);
      });

      $('.edit-item-btn').on('click', function() {
        const itemId = $(this).data('item-id');
        openEditModal(itemId);
      });
    }

    // Add menu item
    async function addMenuItem(event) {
      event.preventDefault();

      const name = $('#itemName').val().trim();
      const description = quill.root.innerHTML;
      const categories = [];
      $('input[name="category"]:checked').each(function() {
        categories.push($(this).val());
      });

      if (!name) {
        showMessage('Please enter a menu item name', true);
        return;
      }

      try {
        await api.createMenuItem({
          name: name,
          description: description,
          categories: categories
        });

        showMessage('Menu item added successfully!');
        
        // Reset form
        $('#itemName').val('');
        quill.setContents([]);
        $('input[name="category"]').prop('checked', false);

        // Reload menu items
        await loadMenuItems();
      } catch (error) {
        console.error('Error adding menu item:', error);
        showMessage('Failed to add menu item. Please try again.', true);
      }
    }

    // Open delete modal
    function openDeleteModal(itemId) {
      menuItemToDelete = itemId;
      $('#deleteModal').removeClass('hidden');
    }

    // Close delete modal
    function closeDeleteModal() {
      menuItemToDelete = null;
      $('#deleteModal').addClass('hidden');
    }

    // Confirm delete
    async function confirmDelete() {
      if (!menuItemToDelete) return;

      try {
        await api.deleteMenuItem(menuItemToDelete);
        closeDeleteModal();
        showMessage('Menu item deleted successfully!');
        await loadMenuItems();
      } catch (error) {
        console.error('Error deleting menu item:', error);
        showMessage('Failed to delete menu item. Please try again.', true);
        closeDeleteModal();
      }
    }

    // Open edit modal
    async function openEditModal(itemId) {
      try {
        const item = await api.getMenuItem(itemId);
        
        $('#editItemId').val(item.menu_item_id);
        $('#editItemName').val(item.name || '');
        editQuill.root.innerHTML = item.description || '';
        
        // Uncheck all categories first
        $('input[name="editCategory"]').prop('checked', false);
        
        // Check the categories assigned to this item
        if (item.categories && item.categories.length > 0) {
          item.categories.forEach(category => {
            $(`input[name="editCategory"][value="${category}"]`).prop('checked', true);
          });
        }
        
        $('#editModal').removeClass('hidden');
      } catch (error) {
        console.error('Error loading menu item for edit:', error);
        showMessage('Failed to load menu item. Please try again.', true);
      }
    }

    // Close edit modal
    function closeEditModal() {
      $('#editModal').addClass('hidden');
    }

    // Save edited menu item
    async function saveEditedMenuItem(event) {
      event.preventDefault();

      const itemId = $('#editItemId').val();
      const name = $('#editItemName').val().trim();
      const description = editQuill.root.innerHTML;
      const categories = [];
      $('input[name="editCategory"]:checked').each(function() {
        categories.push($(this).val());
      });

      if (!name) {
        showMessage('Please enter a menu item name', true);
        return;
      }

      try {
        await api.updateMenuItem(itemId, {
          name: name,
          description: description,
          categories: categories
        });

        closeEditModal();
        showMessage('Menu item updated successfully!');
        await loadMenuItems();
      } catch (error) {
        console.error('Error updating menu item:', error);
        showMessage('Failed to update menu item. Please try again.', true);
      }
    }

    // Check if user is admin
    async function checkAdminAccess() {
      try {
        const user = await api.getCurrentAuthUser();
        if (user.role !== 'admin') {
          window.location.href = '/index.html';
        }
      } catch (error) {
        console.error('Error checking admin access:', error);
        window.location.href = '/login.html';
      }
    }

    // Initialize page
    $(document).ready(async function() {
      await checkAdminAccess();
      initializeQuillEditors();
      await loadMenuItems();

      // Event listeners
      $('#addMenuItemForm').on('submit', addMenuItem);
      $('#cancelDeleteBtn, #closeDeleteModalBtn').on('click', closeDeleteModal);
      $('#confirmDeleteBtn').on('click', confirmDelete);
      $('#deleteModal').on('click', function(event) {
        if ($(event.target).is('#deleteModal')) {
          closeDeleteModal();
        }
      });

      $('#cancelEditBtn, #closeEditModalBtn').on('click', closeEditModal);
      $('#editMenuItemForm').on('submit', saveEditedMenuItem);
      $('#editModal').on('click', function(event) {
        if ($(event.target).is('#editModal')) {
          closeEditModal();
        }
      });

      $('#retryLoadBtn').on('click', loadMenuItems);

      // Mobile menu toggle
      $('#mobileMenuBtn').on('click', function() {
        $('#mobileMenu').toggleClass('hidden');
      });

      // Logout functionality
      $('#logoutBtn, #logoutBtnMobile').on('click', function() {
        localStorage.removeItem('authToken');
        window.location.href = '/login.html';
      });

      // Update navigation based on auth state
      if (isAuthenticated()) {
        $('#authNav').removeClass('hidden').addClass('flex');
        $('#authNavMobile').removeClass('hidden').addClass('flex');
        $('#guestNav').addClass('hidden');
        $('#guestNavMobile').addClass('hidden');

        try {
          const user = await api.getCurrentAuthUser();
          if (user.role === 'admin') {
            $('#adminLink, #adminLinkMobile').removeClass('hidden');
            $('#userRole, #userRoleMobile').text('Admin').removeClass('bg-[#27AE60]').addClass('bg-[#E67E22]');
          }
        } catch (error) {
          console.error('Error fetching user info:', error);
        }
      } else {
        $('#authNav, #authNavMobile').addClass('hidden');
        $('#guestNav').removeClass('hidden').addClass('flex');
        $('#guestNavMobile').removeClass('hidden').addClass('flex');
      }
    });
  </script>


</body></html>